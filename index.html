<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Optimal Circuits!</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <link href="styles/stylehome.css" rel="stylesheet">
  <link href="styles/bootstarp.css" rel="stylesheet">
  <link href="styles/select.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
    type="text/css">

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
    }

    .bg {
      /* The image used radial gradient*/
      background-image: radial-gradient(rgb(9, 51, 167), rgb(0, 10, 99), rgb(0, 0, 0));

      /* Full height */
      height: 100%;

      /* Center and scale the image nicely */
      background-position: right;
      background-repeat: no-repeat;
      background-size: cover;
    }

    .card-img-top {
      width: 100%;
      height: 25vw;
      object-fit: contain;
    }

    .img {
      border-radius: 50%;
    }

    .img-round {
      height: 2em;
      width: 2em
    }

    .img-fluid {
      height: 10em;
      width: 10em
    }

    .hide {
      position: absolute;
      top: -1px;
      left: -1px;
      width: 1px;
      height: 1px;
    }
  </style>

  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
  <script>$('select').selectpicker();</script>

</head>

<body class="bg">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Optimal Circuits!</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">

        <ul class="navbar-nav mr-auto">

          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
        </ul>

        <ul class="navbar-nav">
          <li class="nav-item dropdown no-arrow">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <!-- <img class="img img-round"
                    src="{{url_for('static', filename='undraw_profile.svg')}}">   -->
              <span class="mr-2 d-none d-lg-inline">Settings</span>
            </a>
            <!-- Dropdown - User Information -->
            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                aria-labelledby="userDropdown">
                <!--<a class="dropdown-item" href="#">
                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                    Profile
                </a>-->
                <!-- <div class="dropdown-divider"></div> -->
                <!-- href="{{ url_for('auth.logout') }}" -->
                <a class="dropdown-item"  data-toggle="modal" data-target="#logoutModal">
                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                    Connect
                </a>
            </div>
          </li>
        </ul>

      </div>
    </div>

  </nav>

  <section class="bg">


    <div class="container">
      <div class="row">

        <center>
          <!-- style="background-image:'templates/cardbg.png'" -->
          <div class="col-lg-7 mb-lg-0 ">
            <div class="card card-signin mx-auto mb-lg-0 my-4">
              <div class="card-body">
                <br  style="display: none;">
                <h5 class="card-title text-center"  style="display: none;">Connection Setting</h5>                
                
                  <iframe name="hiddenFrame" class="hide"></iframe>
                  <form class="form-signin" method="POST" id="form" target="hiddenFrame">

                    <br  style="display: none;">
                    
                    <div class="form-label-group d-flex">
                      <div class="row g-2 align-items-center"  style="display: none;">
                        <div class="col-md-3 text-start" >
                          <label>Enter IP Address*</label>
                        </div>
                        <div class="col-md-9">
                          <div class="row g-7 ">
                            <div class="col-md-2">
                              <input type="text" id="ip1" class="form-control" placeholder="###" name="ip1" required>
                            </div>
                            <div class="col-md-1">
                              <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                            </div>
                            <div class="col-md-2">
                              <input type="text" id="ip2" class="form-control" placeholder="###" name="ip2" required>
                            </div>
                            <div class="col-md-1">
                              <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                            </div>
                            <div class="col-md-2">
                              <input type="text" id="ip3" class="form-control" placeholder="###" name="ip3" required>
                            </div>
                            <div class="col-md-1">
                              <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                            </div>
                            <div class="col-md-2">
                              <input type="text" id="ip4" class="form-control" placeholder="###" name="ip4" required>
                            </div>
                          </div>
                        </div>
                        
                      </div>
                    </div>
    
                    <br>
                    <h5 class="card-title text-center">Light Controls</h5>
    
                    <br>
                    
                    <div class="form-label-group">
                      <div class="row g-2 align-items-center">
                        <label for="lights" class="form-label col-md-3 text-start">Select Light</label>
                        <!-- Rounded switch -->
                        <div class="col-md-9" style="margin-top: 0;">
                          <select class="selectpicker float-end" id="lights" multiple data-live-search="true"  required>
                            <option value="light-light1">Profile Light</option>
                            <option value="light-light2">Strip Light-1</option>
                            <option value="light-light3">Spot Light</option>
                            <option value="light-light4">Strip Light-2</option>
                            <option value="light-light5">Spot Light (CCT)</option>
                            <!-- <option value="light-light6">Light-6</option> -->
                          </select>
                        </div>
                      </div>
                    </div>

                    <br>

                    <div class="form-label-group">
                      <div class="row g-2 align-items-center">
                        <label for="state" class="form-label col-md-6 text-start">OFF / ON</label>
                        <!-- Rounded switch -->
                        <div class="col-md-6">
                          <label class="switch float-end">

                            <input type="checkbox" oninput="query()" id="state" name="state" required>
                            <span class="slider round"></span>

                          </label>
                        </div>                      
                      
                      </div>
                      
                    </div>

                    <br>

                    <div class="form-label-group">
                      <div class="row g-2 align-items-center">
                        <label for="brightness" class="form-label col-md-3 text-start">Brightness</label> <br>
                        <div class="col-md-9">
                          <input type="range" name="brightness" id="brightness" oninput="query()" class="form-range" min="0"
                        max="255" step="1"
                        style="background-image: linear-gradient( to right,rgb(255, 255, 255),rgb(255, 255, 0)) !important; ">
                        </div>
                      </div>
                    </div>

                    <br>

                    <div class="form-label-group">
                      <div class="row g-2 align-items-center">
                        <label for="colourtemp" class="form-label col-md-3 text-start">Colour Temperature</label> <br>
                        <div class="col-md-9">
                          <input type="range" name="colourtemp" id="colourtemp" oninput="query()" class="form-range" 
                          min="100"
                          max="500" 
                          step="0.1"
                          style="background-image: linear-gradient( to right,rgb(135, 223, 255), rgb(255, 255, 255), rgb(255, 196, 0)) !important; ">
                        </div>
                      </div>
                    </div>
                    <br>

                  </form>

              </div>
            </div>
          </div>
        </center>

      </div>
    </div>

  </section>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Connect!</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
            <div class="modal-body">

              <div class="form-label-group d-flex ">
                <div class="row g-2 align-items-center">
                  <div class="col-md-3 text-start">
                    <label>Enter IP Address*</label>
                  </div>
                  <div class="col-md-9">
                    <div class="row g-7 ">
                      <div class="col-md-2">
                        <input type="text" id="ip11" class="form-control" placeholder="###" name="ip11" required>
                      </div>
                      <div class="col-md-1">
                        <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                      </div>
                      <div class="col-md-2">
                        <input type="text" id="ip22" class="form-control" placeholder="###" name="ip22" required>
                      </div>
                      <div class="col-md-1">
                        <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                      </div>
                      <div class="col-md-2">
                        <input type="text" id="ip33" class="form-control" placeholder="###" name="ip33" required>
                      </div>
                      <div class="col-md-1">
                        <h6 style="margin-bottom:0; margin-top:10px">.</h6>
                      </div>
                      <div class="col-md-2">
                        <input type="text" id="ip44" class="form-control" placeholder="###" name="ip44" required>
                      </div>
                    </div>
                  </div>
                  
                </div>
              </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <a class="btn btn-primary" class="close" data-dismiss="modal" aria-label="Close" id="save" onclick="ip()">Save</a>
            </div>
        </div>
    </div>
  </div>

  <script>
      var ip1;
      var ip2;
      var ip3;
      var ip4;

    function ip(event) {
      globalThis.ip1 = document.getElementById('ip11').value;
      globalThis.ip2 = document.getElementById('ip22').value;
      globalThis.ip3 = document.getElementById('ip33').value;
      globalThis.ip4 = document.getElementById('ip44').value;
    }

    function query(event) {
      // console.log(typeof globalThis.ip1);
      // console.log(globalThis.ip2);
      // console.log(globalThis.ip3);
      // console.log(globalThis.ip4);

      var selected_lights = [];
      for (var option of document.getElementById('lights').options) {
        if (option.selected) {
        selected_lights.push(option.value);
        }
      }

      if ((globalThis.ip1 != '') && (globalThis.ip2 != '') && (globalThis.ip3 != '') && (globalThis.ip4 != '') &&
          (!isNaN(globalThis.ip1)) && (!isNaN(globalThis.ip2)) && (!isNaN(globalThis.ip3)) && (!isNaN(globalThis.ip4)) &&
          // (ip1 >= '0') && (ip2 >= '0') && (ip3 >= '0') && (ip4 >= '0') &&
          // (ip1 <= '255') && (ip2 <= '255') && (ip3 <= '255') && (ip4 <= '255') &&
          selected_lights.length>0) {
        var ip = globalThis.ip1 + '.' + globalThis.ip2 + '.' + globalThis.ip3 + '.' + globalThis.ip4;
        console.log(ip)
        
        var state = document.getElementById('state');
        var mode;

        if (state.checked) {
          state = "ON";
          mode = "turn_on";
        } else {
          state = "OFF";
          mode = "turn_off";
        }

        var bright = document.getElementById('brightness').value;
        var color = document.getElementById('colourtemp').value;

        // var url = "https://" + ip + "/light/light4/" + mode";
        // var req_final = "http://" + ip + "/light/light1/" + mode + "?id=" + id + "&state=" + state + "&brightness=" + bright + "&color_temp=" + color;
        // var req = "http://" + ip + "/light/light1/" + mode + "?id=" + id + "&state=" + state + "&brightness=" + bright;

        for (let i = 0; i < selected_lights.length; i++) {
          
            var id = selected_lights[i];
            var light_id = "light" + selected_lights[i].slice(-1);
            if (light_id == 'light5'){
              var req = "http://" + ip + "/light/" + light_id + "/" + mode + "?id=" + id + "&state=" + state + "&brightness=" + bright + "&color_temp=" + color;
            }
            else {
              var req = "http://" + ip + "/light/" + light_id + "/" + mode + "?id=" + id + "&state=" + state + "&brightness=" + bright;
            }
            
            task(i, req);
        }
      } 
    }

    function task(i, req) {
      setTimeout(function() {
        console.log(req);
        document.getElementById("form").action = req;
        document.getElementById("form").submit();
      }, 300 * i);
    }
      
    // return
  </script>


</body>

</html>